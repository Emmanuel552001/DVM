{% extends 'base.html.twig' %}

{% block main %}
<section class="container my-5">

    <h2 class="mb-4">ğŸš— Liste des VÃ©hicules</h2>

    <div class="mb-4">
        <a href="/vehicule/ajouter" class="btn btn-primary me-2">[+] Ajouter</a>
        <a href="/vehicule/tout_supprimer"
           class="btn btn-danger"
           onclick="return confirm('ÃŠtes-vous sÃ»r de vouloir supprimer tous les vÃ©hicules ?');">[x] Tout Supprimer</a>
    </div>

    <label for="select-vehicule">Choisir un vÃ©hicule :</label>
    <select id="select-vehicule" class="form-select mb-3">
        <option value="">SÃ©lectionner un vÃ©hicule</option>
        {% for vehicule in liste_vehicules %}
            <option value="{{ vehicule.VeId }}">{{ vehicule.VeMarque }} - {{ vehicule.VeModele }}</option>
        {% endfor %}
    </select>

    <h3>ğŸ› ï¸ Ã‰quipements du VÃ©hicule</h3>
    <ul id="equipement-list" class="list-group"></ul>

    <button id="ajouter-equipement" class="btn btn-success mt-3" style="display: none;">â• Ajouter un Ã‰quipement</button>

</section>

<script>
document.addEventListener("DOMContentLoaded", function () {
    const selectVehicule = document.getElementById("select-vehicule");
    const equipementList = document.getElementById("equipement-list");
    const ajouterEquipementBtn = document.getElementById("ajouter-equipement");

    selectVehicule.addEventListener("change", function () {
        let vehiculeId = this.value;
        equipementList.innerHTML = "";
        ajouterEquipementBtn.style.display = vehiculeId ? "block" : "none";

        if (vehiculeId) {
            fetch(`/equipements/vehicule/${vehiculeId}`)
                .then(response => response.json())
                .then(data => {
                    equipementList.innerHTML = "";
                    data.equipements.forEach(eq => {
                        let li = document.createElement("li");
                        li.classList.add("list-group-item", "d-flex", "justify-content-between");
                        li.innerHTML = `
                            ${eq.libelle} (${eq.quantite}) - ${eq.prix} â‚¬
                            <span>
                                <button class="btn btn-sm btn-warning" onclick="modifierEquipement(${eq.id})">âœï¸</button>
                                <button class="btn btn-sm btn-danger" onclick="supprimerEquipement(${eq.id})">ğŸ—‘ï¸</button>
                            </span>
                        `;
                        equipementList.appendChild(li);
                    });
                });
        }
    });

    ajouterEquipementBtn.addEventListener("click", function () {
        let vehiculeId = selectVehicule.value;
        window.location.href = `/equipement/ajouter/${vehiculeId}`;
    });
});

function modifierEquipement(equipementId) {
    window.location.href = `/equipement/modifier/${equipementId}`;
}

function supprimerEquipement(equipementId) {
    if (confirm("Supprimer cet Ã©quipement ?")) {
        fetch(`/equipement/supprimer/${equipementId}`, { method: "DELETE" })
            .then(() => location.reload());
    }
}
</script>

{% endblock %}
